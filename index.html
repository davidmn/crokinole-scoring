<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!DOCTYPE html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<title>Crokinole</title>

<html>

<body>
    <h1 class="text-center"> Crokinole Scoring</h1>
    <p class="text-center">Low stakes scoring for the best game ever made</p>
    <h2 class="text-center">Round</h2>
    <div class="col-sm">
        <h4>Player 1</h4>
        <input id="player1score" class="form-control" type="number" pattern="\d*" step="5" min="0" />
    </div>
    <div class="col-sm">
        <h4>Player 2</h4>
        <input id="player2score" class="form-control" type="number" pattern="\d*" step="5" min="0" />
    </div>
    <div class="text-center">
        <button class="btn btn-primary sm" onclick="return Go();">Go</button>
    </div>
    <div class="text-center">
        <h2>Game</h2>
    </div>
    <div class="text-center">
        <p id="scoreDisplay">40:10</p>
    </div>
    <div class="text-center">
        <h2>Previous Games</h2>
        <ol id="gameHistory">
        </ol>
    </div>
    <p class="text-center">
        <a href="https://www.mastersofgames.com/rules/crokinole-rules.htm" target="_blank">Rules</a>
    </p>
    <p class="text-center">
        <a href="https://github.com/davidmn/crokinole-scoring" target="_blank">Code</a>
    </p>
</body>
<script type="text/javascript">
    let player1score = 0;
    let player2score = 0;
    document.getElementById("scoreDisplay").innerText = `${player1score}:${player2score}`

    function Go() {
        HandleRoundEnd();
        HandleGameEnd();
    }

    function HandleRoundEnd() {
        let player1RoundScore = document.getElementById("player1score").value;
        let player2RoundScore = document.getElementById("player2score").value;

        if (player1RoundScore == player2RoundScore) {
            // no-op
            return;
        }

        if (player1RoundScore > player2RoundScore) {
            player1score += (player1RoundScore - player2RoundScore);
        }
        else {
            player2score += (player2RoundScore - player1RoundScore);
        }

        document.getElementById("scoreDisplay").innerText = `${player1score}:${player2score}`;
    }

    function HandleGameEnd() {
        if (player1score >= 100 || player2score >= 100) {
            let winner = "Player 1";
            if (player2score >= 100) {
                winner = "Player 2";
            }
            alert(`${winner} won!`);

            var listItem = document.createElement("li");
            listItem.innerText = `${winner} wins - ${player1score}:${player2score}`;
            document.getElementById("gameHistory").appendChild(listItem);
            player1score = 0;
            player2score = 0;
            document.getElementById("scoreDisplay").innerText = `${player1score}:${player2score}`;
            document.getElementById("player1score").value = "";
            document.getElementById("player2score").value = "";
        }
    }
</script>

</html>
